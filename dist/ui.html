<h3>Change Banner By Multiple Language</h3><input type="file" title="選擇檔案" id="file_input"> <button id="submit">Start</button> <button id="export">Export</button><script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.5.0/jszip.js" integrity="sha512-18QiVdJv36r1ryb5mr1lFpm4wZMORhvGgvz0mHQllOmx3NmSZkYwWuDcecFByaRVWqiQ0F/FZC5pCBMuy8IfkQ==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.js" integrity="sha512-B+gr+zLWg81qxVwvtYwKrmjvQtZKD/GGFF7jD80OfzbqFw+NsbS5faEqpCO7Q7oRw1bYi0+WLJf54j8Vm7NADw==" crossorigin="anonymous"></script><script>const wsName = "工作表1"

  const fileInput = document.getElementById("file_input")
  let fileReader = new FileReader()
  fileInput.addEventListener('change', (event) => {
    const files = event.target.files;
    const file = files[0]

    fileReader.readAsBinaryString(file)
  })

  let rowData = [];
  fileReader.addEventListener("load", function (event) {
    let data = event.target.result; //array buffer
    let wb = XLSX.read(data, { type: "binary" });

    wb.SheetNames.forEach(function (sheetName) {
      if (sheetName === wsName) {
        let rowObject = XLSX.utils.sheet_to_row_object_array(wb.Sheets[sheetName]);
        rowData = rowObject;
      }
    })
  })

  document.getElementById('submit').onclick = () => {
    parent.postMessage({ pluginMessage: rowData }, '*');
  }

  document.getElementById('export').onclick = () => {
    parent.postMessage({ pluginMessage: "export" }, '*');
  }

  window.onmessage = async event => {
    const data = event.data.pluginMessage;

    let zip = new JSZip();
    const folderName = "images/"
    data.forEach(d => {
      let filename = d["name"].replace("*", "-")
      zip.file(folderName + filename + ".png", d["buffer"])
    })

    zip.generateAsync({ type: "blob", compressLevel: 9, compress: "default" }).then(function (content) {
      saveAs(content, "example.zip");
    });
  }</script>