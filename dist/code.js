(()=>{"use strict";var e=function(e,n,t,i){return new(t||(t=Promise))((function(o,f){function a(e){try{r(i.next(e))}catch(e){f(e)}}function l(e){try{r(i.throw(e))}catch(e){f(e)}}function r(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,l)}r((i=i.apply(e,n||[])).next())}))};figma.showUI(__html__,{width:480,height:240});let n=[],t=new Object;function i(e,n,t){e.visible=!1;let i=(o=e.name,f=n,t.find((function(e){return e.name===f&&e.region===o})));var o,f;return e.characters=i.text,e.fontName={family:i.fontFamily,style:i.fontStyle},e}figma.ui.onmessage=f=>e(void 0,void 0,void 0,(function*(){if("export"===f)!function(){e(this,void 0,void 0,(function*(){let i=[];const f=n=>e(this,void 0,void 0,(function*(){for(let e of figma.currentPage.children)if("預覽"===e.name){let t=figma.getNodeById(e.id);for(let e of t.children)o=e.name,yield e.exportAsync(undefined).then((e=>{i.push({lang:n,name:o,buffer:e})}))}}));for(const[e,i]of Object.entries(t)){let t=n.filter((n=>n.name===e));t.forEach((e=>{e.visible=!0})),yield f(e).then((()=>console.log("store: ",e,"buffer"))),t.forEach((e=>{e.visible=!1}))}figma.ui.postMessage(i)}))}();else{let e=function(e){let n=[];for(let t of e){const e=JSON.stringify(t),i=JSON.parse(e);switch(i.Name){case"主標":case"小標":n.unshift({name:i.Name,region:i.Region,text:i.Text,fontFamily:i.FontFamily,fontStyle:i.FontStyle})}}return n}(f);!function(e){for(let n of e)null==t[n.region]&&(t[n.region]=[]),t[n.region].push(n.name)}(e);for(let n of e)null!=n.fontFamily&&(yield figma.loadFontAsync({family:n.fontFamily,style:n.fontStyle}));for(let t of e)figma.currentPage.selection.forEach((o=>{t.name==o.name&&figma.getNodeById(o.id).children.forEach((o=>{o.name==t.region&&n.unshift(i(o,t.name,e))}))}))}}));let o=""})();