(()=>{"use strict";var e=function(e,n,t,i){return new(t||(t=Promise))((function(o,f){function a(e){try{l(i.next(e))}catch(e){f(e)}}function r(e){try{l(i.throw(e))}catch(e){f(e)}}function l(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,r)}l((i=i.apply(e,n||[])).next())}))};figma.showUI(__html__,{width:500,height:340});let n=new Object;function t(e,n,t){e.visible=!1;let i=(o=e.name,f=n,t.find((function(e){return e.name===f&&e.region===o})));var o,f;return e.characters=i.text,e.fontName={family:i.fontFamily,style:i.fontStyle},e}figma.ui.onmessage=f=>e(void 0,void 0,void 0,(function*(){if("export"===f)!function(){e(this,void 0,void 0,(function*(){let t=[];const f=n=>e(this,void 0,void 0,(function*(){for(let e of figma.currentPage.children)if("預覽"===e.name){let o=figma.getNodeById(e.id);for(let e of o.children)i=e.name,yield e.exportAsync(undefined).then((e=>{t.push({lang:n,name:i,buffer:e})}))}}));for(const[e,t]of Object.entries(n)){let n=o().filter((n=>n.name===e));n.forEach((e=>{e.visible=!0})),yield f(e).then((()=>console.log("store: ",e,"buffer"))),n.forEach((e=>{e.visible=!1}))}figma.ui.postMessage(t)}))}();else{let e=function(e){let n=[];for(let t of e){const e=JSON.stringify(t),i=JSON.parse(e);switch(i.Name){case"主標":case"小標":n.unshift({name:i.Name,region:i.Region,text:i.Text,fontFamily:i.FontFamily,fontStyle:i.FontStyle})}}return n}(f);!function(e){for(let t of e)null==n[t.region]&&(n[t.region]=[]),n[t.region].push(t.name)}(e);for(let n of e)null!=n.fontFamily&&(yield figma.loadFontAsync({family:n.fontFamily,style:n.fontStyle}));for(let e of o()){let n=e.fontName;void 0!==n&&(yield figma.loadFontAsync({family:n.family,style:n.style}))}for(let n of e)void 0!==n.text&&figma.currentPage.children.forEach((i=>{"設置"===i.name&&figma.getNodeById(i.id).children.forEach((i=>{n.name==i.name&&figma.getNodeById(i.id).children.forEach((i=>{i.name==n.region&&t(i,n.name,e)}))}))}));figma.ui.postMessage("success")}}));let i="";function o(){let e=[];return figma.currentPage.children.forEach((n=>{"設置"===n.name&&figma.getNodeById(n.id).children.forEach((n=>{"主標"!==n.name&&"小標"!==n.name||figma.getNodeById(n.id).children.forEach((n=>{e.unshift(n)}))}))})),e}})();